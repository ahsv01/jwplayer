!function(){var e="dai",t="-1",i="adError",a="time",r=".jw-media",n="jw-flag-ads",s=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o={adcounterdynamic:"Ad __AD_POD_CURRENT__ of __AD_POD_LENGTH__. ",admessage:"This ad will end in xx",apiKey:"",assetKey:"",cmsID:"",cuetext:"Advertisement",debug:!1,liveAdMessage:"Playing Ad",loadingMessage:"Loading",videoID:""},l=function e(t,i){s(this,e),this.config=t,this.utils=i;for(var a in o)if(o.hasOwnProperty(a)){var r=t[a],n=o[a],l=typeof n;if(void 0!==r){if("boolean"!==l&&"number"!==l||(r=d(r)),typeof r!==l)throw new Error("invalid parameter: "+a+" should be a "+l);this[a]=r}else this[a]=n}};function d(e){if("true"===e)return!0;if("false"===e)return!1;var t=parseFloat(e);return isNaN(t)?e:t}var h=null;function p(e){if(h)return h;if(window.google&&google.ima&&google.ima.dai)return h=Promise.resolve();var t=["//","imasdk.googleapis.com/js/sdkloader/ima3_dai.js"];"file:"===document.location.protocol&&t.unshift("https:");var i=new e.scriptloader(t.join(""));return h=i.load().then(function(){})}var c={};function m(e,t){var i=this,a=c[t];if(a)return a;this.jwplayerEntitlements=function(e,t,i){var a={canPlayAds:!0},r=new e.key(t),n=r.edition();if("unlimited"===n)return i(a);var s=r.token(),o=["//","entitlements.jwplayer.com","/",s,".json"];"file:"===window.location.protocol&&o.unshift("https:"),e.ajax(o.join(""),function(e){a.canPlayAds=!e||!e.response||!1!==e.response.canPlayAds,i(a)},function(){i(a)},{timeout:1e4,responseType:"json"})};return c[t]=new Promise(function(a,r){i.jwplayerEntitlements(e,t,function(e){e.canPlayAds?a():r({message:"Ad Limit Reached"})})})}var g=function(){function e(t,i,a,n,o){var l=this;s(this,e),a.utils.extend(this,a.Events),this.adCues=[],this.item=t,this.options=i,this.player=a,this.env=a.getEnvironment(),this.utils=a.utils,this.daiUtils=n,this.instreamProvider=o,this.blockingInstreamPlayer=null,this.timeoutAdStart=-1,this.playerContainer=a.getContainer(),this.isVOD=i.cmsID&&i.videoID,this.video=null,this.liveMode=!1,this.streamEventHandler=function(e){l.onStreamEvent(e)},this.clickElement=this.env.OS.mobile?document.createElement("div"):this.playerContainer.querySelector(r)}return e.prototype.beforePlay=function(){var e=this;this.blockingInstreamPlayer||this.destroyed()||(clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout(function(){e.destroyed()||e.stopBlocking()},"3000"),this.video=this.player.getContainer().querySelector("video"),this.blockingInstreamPlayer=this.player.createInstream().init(),this.blockingInstreamPlayer.setText(this.options.loadingMessage),this.init().then(function(t){e.loadStream(t)}).catch(function(){e.stopBlocking()}))},e.prototype.stopBlocking=function(){this.destroyed()||(clearTimeout(this.timeoutAdStart),this.destroyBlockingInstreamPlayer())},e.prototype.init=function(){var e=this,t=p().then(function(){if(e.destroyed())return null;var t=new Promise(function(t,i){e.daiStreamLoaded=t,e.daiStreamFailed=i});e.streamManager=new google.ima.dai.api.StreamManager(e.video),e.streamManager.setClickElement(e.clickElement),e.streamManagerEvents=[google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,google.ima.dai.api.StreamEvent.Type.CLICK,google.ima.dai.api.StreamEvent.Type.COMPLETE,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,google.ima.dai.api.StreamEvent.Type.ERROR,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.MIDPOINT,google.ima.dai.api.StreamEvent.Type.STARTED,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE],e.streamManager.addEventListener(e.streamManagerEvents,e.streamEventHandler,!1);var i=void 0;return e.isVOD?((i=new google.ima.dai.api.VODStreamRequest).contentSourceId=e.options.cmsID,i.videoId=e.options.videoID,e.player.on(a,e.checkMidrolls,e)):(e.liveMode=!0,(i=new google.ima.dai.api.LiveStreamRequest).assetKey=e.options.assetKey,e.player.on("meta",e.handleMeta,e)),i.apiKey=e.options.apiKey,e.streamManager.requestStream(i),t});return t.catch(this.utils.noop),t},e.prototype.loadStream=function(e){var t=this.player.getPlaylistItem(this.player.getPlaylistIndex()),i=e.url;t.sources=[this.utils.extend(t.sources[0],{file:i})],this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.replacePlaylistItem(t),this.destroyBlockingInstreamPlayer())},e.prototype.onStreamEvent=function(e){var a=this,r=this.daiUtils.adEventObject(e.getAd());switch(e.type){case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:this.player.trigger("adBreakEnd",r),this.setAdsMode(!1);break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:this.player.trigger("adBreakStart",r),this.setAdsMode(!0);break;case google.ima.dai.api.StreamEvent.Type.AD_PROGRESS:this.handleTime(e.getStreamData().adProgressData,r);break;case google.ima.dai.api.StreamEvent.Type.CLICK:this.trigger("adClick",r),this.player.pause(),setTimeout(function(){a.player.pause()},0);break;case google.ima.dai.api.StreamEvent.Type.COMPLETE:this.trigger("adComplete",r);break;case google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED:var n=this.adCues=e.getStreamData().cuepoints;if(n&&n.length){var s=n.filter(function(e){return e.start>0}).map(function(e){return{begin:e.start,text:a.options.cuetext}});this.player.setCues([]),this.player.setCues(s)}break;case google.ima.dai.api.StreamEvent.Type.ERROR:var o=e.getStreamData().errorMessage,l=this.utils.extend({id:t,message:"Ad Error: "+o},r);this.trigger(i,l);break;case google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE:break;case google.ima.dai.api.StreamEvent.Type.LOADED:clearTimeout(this.timeoutAdStart),this.daiStreamLoaded(e.getStreamData());break;case google.ima.dai.api.StreamEvent.Type.MIDPOINT:break;case google.ima.dai.api.StreamEvent.Type.STARTED:this.trigger("adImpression",r);var d=this.player.getState();"playing"===d&&this.trigger("adPlay",{oldstate:"unknown",newstate:d});break;case google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE:}},e.prototype.checkMidrolls=function(e){if(this.adCues.length){for(var t=e.position,i=-1,a=0;a<this.adCues.length&&!(this.adCues[a].start>t);a++)i=a;i>-1&&!this.adCues[i].played&&t!==this.adCues[i].start&&(this.playerPositionBeforeMidroll=t,this.player.seek(this.adCues[i].start))}},e.prototype.handleMeta=function(e){this.streamManager&&this.streamManager.onTimedMetadata(e.metadata)},e.prototype.handlePlayPause=function(){var e=this;this.player.on("play",function(t){var i={};i.oldstate=t.oldstate,i.newstate=t.newstate,e.trigger("adPlay",i)},this),this.player.on("pause",function(t){var i={};i.oldstate=t.oldstate,i.newstate=t.newstate,e.trigger("adPause",i)},this)},e.prototype.setAdsMode=function(e){var t=this;e?(this.player.off(a,this.checkMidrolls,this),this.utils.addClass(this.playerContainer,n),this.handlePlayPause(),this.blockingInstreamPlayer||(this.blockingInstreamPlayer=this.player.createInstream()),this.blockingInstreamPlayer.addAdProgramTimeListener(),this.blockingInstreamPlayer.applyProviderListeners(this.instreamProvider),this.liveMode&&this.blockingInstreamPlayer.setText(this.options.liveAdMessage),this.env.OS.mobile&&(this.blockingInstreamPlayer.off(null,null,this),this.blockingInstreamPlayer.on("instreamClick",function(){"paused"===t.player.getState()?t.player.play():t.clickElement.click()},this))):(this.isVOD&&this.player.on(a,this.checkMidrolls,this),this.utils.removeClass(this.playerContainer,n),this.player.off("play",null,this),this.player.off("pause",null,this),this.destroyBlockingInstreamPlayer(),this.playerPositionBeforeMidroll&&(this.player.seek(this.playerPositionBeforeMidroll),this.playerPositionBeforeMidroll=null))},e.prototype.adProgress=function(e){if(this.blockingInstreamPlayer){var t=e.adPosition,i=e.currentTime,a=e.duration,r=e.totalAds,n=this.options.admessage||"",s=this.options.adcounterdynamic||"";n=n.replace(/xx/gi,""+Math.ceil(a-i)),r>1&&(n=(s=(s=s.replace(/__AD_POD_CURRENT__/g,""+t)).replace(/__AD_POD_LENGTH__/g,""+r))+n),this.blockingInstreamPlayer.setText(n)}},e.prototype.handleTime=function(e,t){var i=e.currentTime,r=e.duration;t.position=i,t.duration=r,this.trigger("adTime",t),this.instreamProvider.trigger(a,t),this.liveMode||this.adProgress(e)},e.prototype.destroyBlockingInstreamPlayer=function(){this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(null,null,this),this.blockingInstreamPlayer.setText(""),this.blockingInstreamPlayer.destroy(),this.blockingInstreamPlayer=null)},e.prototype.destroy=function(){this.off(),this.player.off(null,null,this),clearTimeout(this.timeoutAdStart),this.destroyed()||(this.streamManager&&this.streamManager.removeEventListener(this.streamManagerEvents,this.streamEventHandler,!1),this.options=null,this.video=null,this.daiStreamFailed("DAI ad plugin destroyed"),this.daiStreamFailed=null,this.daiStreamLoaded=null,this.destroyBlockingInstreamPlayer(),this.player=null,this.item=null)},e.prototype.destroyed=function(){return!this.item},e}(),u=function(){function i(e){s(this,i),this.player=e,this.adIds={}}return i.prototype.getAdId=function(e){if(e){var i=e.getAdId(),a=y(e);if(a&&(i=""+a.getTimeOffset()),i)return void 0===this.adIds[i]&&(this.adIds[i]=(r=12,new Array(r+1).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,r))),this.adIds[i]}var r;return t},i.prototype.adEventObject=function(t){var i={client:e,viewable:this.player.getViewable()};if(!t)return i;i.id=this.getAdId(t),i.adtitle=t.getTitle(),i.adsystem=t.getAdSystem(),i.creativetype="application/x-mpegURL",i.linear="linear";var a=y(t);if(a){var r=a.getTotalAds();r>1&&(i.sequence=a.getAdPosition(),i.podcount=r);var n=a.getTimeOffset(),s="mid";0===n?s="pre":-1===n&&(s="post"),i.adposition=s}return i},i}();function y(e){try{return e.getAdPodInfo()}catch(e){return null}}var f=function(){function e(t,i){s(this,e),t.extend(this,i)}return e.prototype.attachMedia=function(){},e.prototype.detachMedia=function(){},e.prototype.volume=function(){},e.prototype.mute=function(){},e}();(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(e,"8.0",function(a,r){var n=this,s=a.utils,o=a.getConfig(),d=new l(r||{},s),h=new u(a),c=new f(s,a.Events),y=void 0;p(s).catch(s.noop);var v=o.key;this.version="0.3.1",s.extend(this,a.Events);function E(){y&&(y.destroy(),y=null)}a.on("ready",function(){p(s).catch(function(){a.getAdBlock()&&T("Ad playback blocked by an ad blocker",2e4)}),P.catch(function(e){T("Ad Error: "+e.message,60002)})},this).on("playlistItem",function(e){var t=e.item;t.preload="none",i=t,r=s.extend({},d,t.daiSetting),E(),(y=new g(i,r,a,h,c)).on("all",function(e,t){return a.trigger(e,t)}),a.once("beforePlay",y.beforePlay,y);var i,r},this).on("destroyPlugin",function(){n.destroy()},this);var P=m.call(this,s,v);P.catch(s.noop);function T(r,n){E(),a.off(null,null,this),a.trigger(i,{id:t,client:e,message:r,code:900,adErrorCode:n,tag:""})}this.destroy=E})}();
